"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const child_process_1 = require("child_process");
const os = require("os");
const path = require("path");
const util_1 = require("util");
const fs = require("fs-extra");
const migrate_1 = require("../../lib/commands/migrate");
const mock_sdk_1 = require("../util/mock-sdk");
const exec = (0, util_1.promisify)(child_process_1.exec);
describe('Migrate Function Tests', () => {
    let sdkProvider;
    let getTemplateMock;
    let describeStacksMock;
    let cfnMocks;
    const testResourcePath = [__dirname, 'test-resources'];
    const templatePath = [...testResourcePath, 'templates'];
    const stackPath = [...testResourcePath, 'stacks'];
    const validTemplatePath = path.join(...templatePath, 's3-template.json');
    const validTemplate = (0, migrate_1.readFromPath)(validTemplatePath);
    beforeEach(async () => {
        sdkProvider = new mock_sdk_1.MockSdkProvider();
        getTemplateMock = jest.fn();
        describeStacksMock = jest.fn();
        cfnMocks = { getTemplate: getTemplateMock, describeStacks: describeStacksMock };
        sdkProvider.stubCloudFormation(cfnMocks);
    });
    test('validateSourceOptions throws if both --from-path and --from-stack is provided', () => {
        expect(() => (0, migrate_1.validateSourceOptions)('any-value', true)).toThrowError('Only one of `--from-path` or `--from-stack` may be provided.');
    });
    test('validateSourceOptions throws if neither --from-path or --from-stack is provided', () => {
        expect(() => (0, migrate_1.validateSourceOptions)(undefined, undefined)).toThrowError('Either `--from-path` or `--from-stack` must be used to provide the source of the CloudFormation template.');
    });
    test('validateSourceOptions does not throw when only --from-path is supplied', () => {
        expect(() => (0, migrate_1.validateSourceOptions)('any-value', false)).not.toThrow();
    });
    test('validateSourceOptions does now throw when only --from-stack is provided', () => {
        expect(() => (0, migrate_1.validateSourceOptions)(undefined, true)).not.toThrow();
    });
    test('readFromPath produces a string representation of the template at a given path', () => {
        expect((0, migrate_1.readFromPath)(validTemplatePath)).toEqual(fs.readFileSync(validTemplatePath, 'utf8'));
    });
    test('readFromPath returns undefined when template file is not provided', () => {
        expect((0, migrate_1.readFromPath)()).toEqual(undefined);
    });
    test('readFromPath throws error when template file does not exist at a given path', () => {
        const badTemplatePath = './not-here.json';
        expect(() => (0, migrate_1.readFromPath)(badTemplatePath)).toThrowError(`\'${badTemplatePath}\' is not a valid path.`);
    });
    test('readFromStack produces a string representation of the template retrieved from CloudFormation', async () => {
        const template = fs.readFileSync(validTemplatePath, { encoding: 'utf-8' });
        getTemplateMock.mockImplementation(() => ({
            TemplateBody: template,
        }));
        describeStacksMock.mockImplementation(() => ({
            Stacks: [
                {
                    StackName: 'this-one',
                    StackStatus: 'CREATE_COMPLETE',
                },
            ],
        }));
        expect(await (0, migrate_1.readFromStack)('this-one', sdkProvider, { account: 'num', region: 'here', name: 'hello-my-name-is-what...' })).toEqual(JSON.stringify(JSON.parse(template)));
    });
    test('readFromStack throws error when no stack exists with the stack name in the account and region', async () => {
        describeStacksMock.mockImplementation(() => { throw new Error('No stack. This did not go well.'); });
        await expect(() => (0, migrate_1.readFromStack)('that-one', sdkProvider, { account: 'num', region: 'here', name: 'hello-my-name-is-who...' })).rejects.toThrow('No stack. This did not go well.');
    });
    test('readFromStack throws error when stack exists but the status is not healthy', async () => {
        describeStacksMock.mockImplementation(() => ({
            Stacks: [
                {
                    StackName: 'this-one',
                    StackStatus: 'CREATE_FAILED',
                    StackStatusReason: 'Something went wrong',
                },
            ],
        }));
        await expect(() => (0, migrate_1.readFromStack)('that-one', sdkProvider, { account: 'num', region: 'here', name: 'hello-my-name-is-chicka-chicka...' })).rejects.toThrow('Stack \'that-one\' in account num and region here has a status of \'CREATE_FAILED\' due to \'Something went wrong\'. The stack cannot be migrated until it is in a healthy state.');
    });
    test('setEnvironment sets account and region when provided', () => {
        expect((0, migrate_1.setEnvironment)('my-account', 'somewhere')).toEqual({ account: 'my-account', region: 'somewhere', name: 'cdk-migrate-env' });
    });
    test('serEnvironment uses default account and region when not provided', () => {
        expect((0, migrate_1.setEnvironment)()).toEqual({ account: 'unknown-account', region: 'unknown-region', name: 'cdk-migrate-env' });
    });
    test('generateStack generates the expected stack string when called for typescript', () => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodTypeScript', 'typescript');
        expect(stack).toEqual(fs.readFileSync(path.join(...stackPath, 's3-stack.ts'), 'utf8'));
    });
    test('generateStack generates the expected stack string when called for python', () => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodPython', 'python');
        expect(stack).toEqual(fs.readFileSync(path.join(...stackPath, 's3_stack.py'), 'utf8'));
    });
    test('generateStack generates the expected stack string when called for java', () => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodJava', 'java');
        expect(stack).toEqual(fs.readFileSync(path.join(...stackPath, 'S3Stack.java'), 'utf8'));
    });
    test('generateStack generates the expected stack string when called for csharp', () => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodCSharp', 'csharp');
        expect(stack).toEqual(fs.readFileSync(path.join(...stackPath, 'S3Stack.cs'), 'utf8'));
    });
    // TODO: fix with actual go template
    test('generateStack generates the expected stack string when called for go', () => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodGo', 'go');
        expect(stack).toEqual(fs.readFileSync(path.join(...stackPath, 's3.go'), 'utf8'));
    });
    test('generateStack throws error when called for other language', () => {
        expect(() => (0, migrate_1.generateStack)(validTemplate, 'BadBadBad', 'php')).toThrowError('stack generation failed due to error \'unreachable\'');
    });
    cliTest('generateCdkApp generates the expected cdk app when called for typescript', async (workDir) => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodTypeScript', 'typescript');
        await (0, migrate_1.generateCdkApp)('GoodTypeScript', stack, 'typescript', workDir);
        // Packages exist in the correct spot
        expect(fs.pathExistsSync(path.join(workDir, 'GoodTypeScript', 'package.json'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodTypeScript', 'bin', 'good_type_script.ts'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodTypeScript', 'lib', 'good_type_script-stack.ts'))).toBeTruthy();
        // Replaced stack file is referenced correctly in app file
        const app = fs.readFileSync(path.join(workDir, 'GoodTypeScript', 'bin', 'good_type_script.ts'), 'utf8').split('\n');
        expect(app.map(line => line.match('import { GoodTypeScriptStack } from \'../lib/good_type_script-stack\';')).filter(line => line).length).toEqual(1);
        expect(app.map(line => line.match(/new GoodTypeScriptStack\(app, \'GoodTypeScript\', \{/)).filter(line => line).length).toEqual(1);
        // Replaced stack file is correctly generated
        const replacedStack = fs.readFileSync(path.join(workDir, 'GoodTypeScript', 'lib', 'good_type_script-stack.ts'), 'utf8');
        expect(replacedStack).toEqual(fs.readFileSync(path.join(...stackPath, 's3-stack.ts'), 'utf8'));
    });
    cliTest('generateCdkApp generates the expected cdk app when called for python', async (workDir) => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodPython', 'python');
        await (0, migrate_1.generateCdkApp)('GoodPython', stack, 'python', workDir);
        // Packages exist in the correct spot
        expect(fs.pathExistsSync(path.join(workDir, 'GoodPython', 'requirements.txt'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodPython', 'app.py'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodPython', 'good_python', 'good_python_stack.py'))).toBeTruthy();
        // Replaced stack file is referenced correctly in app file
        const app = fs.readFileSync(path.join(workDir, 'GoodPython', 'app.py'), 'utf8').split('\n');
        expect(app.map(line => line.match('from good_python.good_python_stack import GoodPythonStack')).filter(line => line).length).toEqual(1);
        expect(app.map(line => line.match(/GoodPythonStack\(app, "GoodPython",/)).filter(line => line).length).toEqual(1);
        // Replaced stack file is correctly generated
        const replacedStack = fs.readFileSync(path.join(workDir, 'GoodPython', 'good_python', 'good_python_stack.py'), 'utf8');
        expect(replacedStack).toEqual(fs.readFileSync(path.join(...stackPath, 's3_stack.py'), 'utf8'));
    });
    cliTest('generateCdkApp generates the expected cdk app when called for java', async (workDir) => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodJava', 'java');
        await (0, migrate_1.generateCdkApp)('GoodJava', stack, 'java', workDir);
        // Packages exist in the correct spot
        expect(fs.pathExistsSync(path.join(workDir, 'GoodJava', 'pom.xml'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodJava', 'src', 'main', 'java', 'com', 'myorg', 'GoodJavaApp.java'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodJava', 'src', 'main', 'java', 'com', 'myorg', 'GoodJavaStack.java'))).toBeTruthy();
        // Replaced stack file is referenced correctly in app file
        const app = fs.readFileSync(path.join(workDir, 'GoodJava', 'src', 'main', 'java', 'com', 'myorg', 'GoodJavaApp.java'), 'utf8').split('\n');
        expect(app.map(line => line.match('public class GoodJavaApp {')).filter(line => line).length).toEqual(1);
        expect(app.map(line => line.match(/        new GoodJavaStack\(app, "GoodJava", StackProps.builder()/)).filter(line => line).length).toEqual(1);
        // Replaced stack file is correctly generated
        const replacedStack = fs.readFileSync(path.join(workDir, 'GoodJava', 'src', 'main', 'java', 'com', 'myorg', 'GoodJavaStack.java'), 'utf8');
        expect(replacedStack).toEqual(fs.readFileSync(path.join(...stackPath, 'S3Stack.java'), 'utf8'));
    });
    cliTest('generateCdkApp generates the expected cdk app when called for csharp', async (workDir) => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodCSharp', 'csharp');
        await (0, migrate_1.generateCdkApp)('GoodCSharp', stack, 'csharp', workDir);
        // Packages exist in the correct spot
        expect(fs.pathExistsSync(path.join(workDir, 'GoodCSharp', 'src', 'GoodCSharp.sln'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodCSharp', 'src', 'GoodCSharp', 'Program.cs'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodCSharp', 'src', 'GoodCSharp', 'GoodCSharpStack.cs'))).toBeTruthy();
        // Replaced stack file is referenced correctly in app file
        const app = fs.readFileSync(path.join(workDir, 'GoodCSharp', 'src', 'GoodCSharp', 'Program.cs'), 'utf8').split('\n');
        expect(app.map(line => line.match('namespace GoodCSharp')).filter(line => line).length).toEqual(1);
        expect(app.map(line => line.match(/        new GoodCSharpStack\(app, "GoodCSharp", new GoodCSharpStackProps/)).filter(line => line).length).toEqual(1);
        // Replaced stack file is correctly generated
        const replacedStack = fs.readFileSync(path.join(workDir, 'GoodCSharp', 'src', 'GoodCSharp', 'GoodCSharpStack.cs'), 'utf8');
        expect(replacedStack).toEqual(fs.readFileSync(path.join(...stackPath, 'S3Stack.cs'), 'utf8'));
    });
    cliTest('generatedCdkApp generates the expected cdk app when called for go', async (workDir) => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodGo', 'go');
        await (0, migrate_1.generateCdkApp)('GoodGo', stack, 'go', workDir);
        expect(fs.pathExists(path.join(workDir, 's3.go'))).toBeTruthy();
        const app = fs.readFileSync(path.join(workDir, 'GoodGo', 'good_go.go'), 'utf8').split('\n');
        expect(app.map(line => line.match(/func NewGoodGoStack\(scope constructs.Construct, id string, props \*GoodGoStackProps\) \*GoodGoStack \{/)).filter(line => line).length).toEqual(1);
        expect(app.map(line => line.match(/    NewGoodGoStack\(app, "GoodGo", &GoodGoStackProps\{/)));
    });
    cliTest('generatedCdkApp generates a zip file when --compress is used', async (workDir) => {
        const stack = (0, migrate_1.generateStack)(validTemplate, 'GoodTypeScript', 'typescript');
        await (0, migrate_1.generateCdkApp)('GoodTypeScript', stack, 'typescript', workDir, true);
        // Packages not in outDir
        expect(fs.pathExistsSync(path.join(workDir, 'GoodTypeScript', 'package.json'))).toBeFalsy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodTypeScript', 'bin', 'good_type_script.ts'))).toBeFalsy();
        expect(fs.pathExistsSync(path.join(workDir, 'GoodTypeScript', 'lib', 'good_type_script-stack.ts'))).toBeFalsy();
        // Zip file exists
        expect(fs.pathExistsSync(path.join(workDir, 'GoodTypeScript.zip'))).toBeTruthy();
        // Unzip it
        await exec(`unzip ${path.join(workDir, 'GoodTypeScript.zip')}`, { cwd: workDir });
        // Now the files should be there
        expect(fs.pathExistsSync(path.join(workDir, 'package.json'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'bin', 'good_type_script.ts'))).toBeTruthy();
        expect(fs.pathExistsSync(path.join(workDir, 'lib', 'good_type_script-stack.ts'))).toBeTruthy();
    });
});
function cliTest(name, handler) {
    test(name, () => withTempDir(handler));
}
async function withTempDir(cb) {
    const tmpDir = await fs.mkdtemp(path.join(os.tmpdir(), 'aws-cdk-test'));
    try {
        await cb(tmpDir);
    }
    finally {
        await fs.remove(tmpDir);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWlncmF0ZS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWlncmF0ZS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsaURBQThDO0FBQzlDLHlCQUF5QjtBQUN6Qiw2QkFBNkI7QUFDN0IsK0JBQWlDO0FBQ2pDLCtCQUErQjtBQUMvQix3REFBK0k7QUFDL0ksK0NBQXNGO0FBRXRGLE1BQU0sSUFBSSxHQUFHLElBQUEsZ0JBQVMsRUFBQyxvQkFBSyxDQUFDLENBQUM7QUFFOUIsUUFBUSxDQUFDLHdCQUF3QixFQUFFLEdBQUcsRUFBRTtJQUN0QyxJQUFJLFdBQTRCLENBQUM7SUFDakMsSUFBSSxlQUEwQixDQUFDO0lBQy9CLElBQUksa0JBQTZCLENBQUM7SUFDbEMsSUFBSSxRQUErRCxDQUFDO0lBRXBFLE1BQU0sZ0JBQWdCLEdBQUcsQ0FBQyxTQUFTLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztJQUN2RCxNQUFNLFlBQVksR0FBRyxDQUFDLEdBQUcsZ0JBQWdCLEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDeEQsTUFBTSxTQUFTLEdBQUcsQ0FBQyxHQUFHLGdCQUFnQixFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBRWxELE1BQU0saUJBQWlCLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLFlBQVksRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO0lBQ3pFLE1BQU0sYUFBYSxHQUFHLElBQUEsc0JBQVksRUFBQyxpQkFBaUIsQ0FBRSxDQUFDO0lBRXZELFVBQVUsQ0FBQyxLQUFLLElBQUksRUFBRTtRQUNwQixXQUFXLEdBQUcsSUFBSSwwQkFBZSxFQUFFLENBQUM7UUFDcEMsZUFBZSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUM1QixrQkFBa0IsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDL0IsUUFBUSxHQUFHLEVBQUUsV0FBVyxFQUFFLGVBQWUsRUFBRSxjQUFjLEVBQUUsa0JBQWtCLEVBQUUsQ0FBQztR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LENBQUMsQ0FBQztLQUN6QjtBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBleGVjIGFzIF9leGVjIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgKiBhcyBvcyBmcm9tICdvcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgcHJvbWlzaWZ5IH0gZnJvbSAndXRpbCc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcy1leHRyYSc7XG5pbXBvcnQgeyBnZW5lcmF0ZUNka0FwcCwgZ2VuZXJhdGVTdGFjaywgcmVhZEZyb21QYXRoLCByZWFkRnJvbVN0YWNrLCBzZXRFbnZpcm9ubWVudCwgdmFsaWRhdGVTb3VyY2VPcHRpb25zIH0gZnJvbSAnLi4vLi4vbGliL2NvbW1hbmRzL21pZ3JhdGUnO1xuaW1wb3J0IHsgTW9ja1Nka1Byb3ZpZGVyLCBNb2NrZWRPYmplY3QsIFN5bmNIYW5kbGVyU3Vic2V0T2YgfSBmcm9tICcuLi91dGlsL21vY2stc2RrJztcblxuY29uc3QgZXhlYyA9IHByb21pc2lmeShfZXhlYyk7XG5cbmRlc2NyaWJlKCdNaWdyYXRlIEZ1bmN0aW9uIFRlc3RzJywgKCkgPT4ge1xuICBsZXQgc2RrUHJvdmlkZXI6IE1vY2tTZGtQcm92aWRlcjtcbiAgbGV0IGdldFRlbXBsYXRlTW9jazogamVzdC5Nb2NrO1xuICBsZXQgZGVzY3JpYmVTdGFja3NNb2NrOiBqZXN0Lk1vY2s7XG4gIGxldCBjZm5Nb2NrczogTW9ja2VkT2JqZWN0PFN5bmNIYW5kbGVyU3Vic2V0T2Y8QVdTLkNsb3VkRm9ybWF0aW9uPj47XG5cbiAgY29uc3QgdGVzdFJlc291cmNlUGF0aCA9IFtfX2Rpcm5hbWUsICd0ZXN0LXJlc291cmNlcyddO1xuICBjb25zdCB0ZW1wbGF0ZVBhdGggPSBbLi4udGVzdFJlc291cmNlUGF0aCwgJ3RlbXBsYXRlcyddO1xuICBjb25zdCBzdGFja1BhdGggPSBbLi4udGVzdFJlc291cmNlUGF0aCwgJ3N0YWNrcyddO1xuXG4gIGNvbnN0IHZhbGlkVGVtcGxhdGVQYXRoID0gcGF0aC5qb2luKC4uLnRlbXBsYXRlUGF0aCwgJ3MzLXRlbXBsYXRlLmpzb24nKTtcbiAgY29uc3QgdmFsaWRUZW1wbGF0ZSA9IHJlYWRGcm9tUGF0aCh2YWxpZFRlbXBsYXRlUGF0aCkhO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIHNka1Byb3ZpZGVyID0gbmV3IE1vY2tTZGtQcm92aWRlcigpO1xuICAgIGdldFRlbXBsYXRlTW9jayA9IGplc3QuZm4oKTtcbiAgICBkZXNjcmliZVN0YWNrc01vY2sgPSBqZXN0LmZuKCk7XG4gICAgY2ZuTW9ja3MgPSB7IGdldFRlbXBsYXRlOiBnZXRUZW1wbGF0ZU1vY2ssIGRlc2NyaWJlU3RhY2tzOiBkZXNjcmliZVN0YWNrc01vY2sgfTtcbiAgICBzZGtQcm92aWRlci5zdHViQ2xvdWRGb3JtYXRpb24oY2ZuTW9ja3MgYXMgYW55KTtcbiAgfSk7XG5cbiAgdGVzdCgndmFsaWRhdGVTb3VyY2VPcHRpb25zIHRocm93cyBpZiBib3RoIC0tZnJvbS1wYXRoIGFuZCAtLWZyb20tc3RhY2sgaXMgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHZhbGlkYXRlU291cmNlT3B0aW9ucygnYW55LXZhbHVlJywgdHJ1ZSkpLnRvVGhyb3dFcnJvcignT25seSBvbmUgb2YgYC0tZnJvbS1wYXRoYCBvciBgLS1mcm9tLXN0YWNrYCBtYXkgYmUgcHJvdmlkZWQuJyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3ZhbGlkYXRlU291cmNlT3B0aW9ucyB0aHJvd3MgaWYgbmVpdGhlciAtLWZyb20tcGF0aCBvciAtLWZyb20tc3RhY2sgaXMgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHZhbGlkYXRlU291cmNlT3B0aW9ucyh1bmRlZmluZWQsIHVuZGVmaW5lZCkpLnRvVGhyb3dFcnJvcignRWl0aGVyIGAtLWZyb20tcGF0aGAgb3IgYC0tZnJvbS1zdGFja2AgbXVzdCBiZSB1c2VkIHRvIHByb3ZpZGUgdGhlIHNvdXJjZSBvZiB0aGUgQ2xvdWRGb3JtYXRpb24gdGVtcGxhdGUuJyk7XG4gIH0pO1xuXG4gIHRlc3QoJ3ZhbGlkYXRlU291cmNlT3B0aW9ucyBkb2VzIG5vdCB0aHJvdyB3aGVuIG9ubHkgLS1mcm9tLXBhdGggaXMgc3VwcGxpZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KCgpID0+IHZhbGlkYXRlU291cmNlT3B0aW9ucygnYW55LXZhbHVlJywgZmFsc2UpKS5ub3QudG9UaHJvdygpO1xuICB9KTtcblxuICB0ZXN0KCd2YWxpZGF0ZVNvdXJjZU9wdGlvbnMgZG9lcyBub3cgdGhyb3cgd2hlbiBvbmx5IC0tZnJvbS1zdGFjayBpcyBwcm92aWRlZCcsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGVTb3VyY2VPcHRpb25zKHVuZGVmaW5lZCwgdHJ1ZSkpLm5vdC50b1Rocm93KCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3JlYWRGcm9tUGF0aCBwcm9kdWNlcyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgdGVtcGxhdGUgYXQgYSBnaXZlbiBwYXRoJywgKCkgPT4ge1xuICAgIGV4cGVjdChyZWFkRnJvbVBhdGgodmFsaWRUZW1wbGF0ZVBhdGgpKS50b0VxdWFsKGZzLnJlYWRGaWxlU3luYyh2YWxpZFRlbXBsYXRlUGF0aCwgJ3V0ZjgnKSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3JlYWRGcm9tUGF0aCByZXR1cm5zIHVuZGVmaW5lZCB3aGVuIHRlbXBsYXRlIGZpbGUgaXMgbm90IHByb3ZpZGVkJywgKCkgPT4ge1xuICAgIGV4cGVjdChyZWFkRnJvbVBhdGgoKSkudG9FcXVhbCh1bmRlZmluZWQpO1xuICB9KTtcblxuICB0ZXN0KCdyZWFkRnJvbVBhdGggdGhyb3dzIGVycm9yIHdoZW4gdGVtcGxhdGUgZmlsZSBkb2VzIG5vdCBleGlzdCBhdCBhIGdpdmVuIHBhdGgnLCAoKSA9PiB7XG4gICAgY29uc3QgYmFkVGVtcGxhdGVQYXRoID0gJy4vbm90LWhlcmUuanNvbic7XG4gICAgZXhwZWN0KCgpID0+IHJlYWRGcm9tUGF0aChiYWRUZW1wbGF0ZVBhdGgpKS50b1Rocm93RXJyb3IoYFxcJyR7YmFkVGVtcGxhdGVQYXRofVxcJyBpcyBub3QgYSB2YWxpZCBwYXRoLmApO1xuICB9KTtcblxuICB0ZXN0KCdyZWFkRnJvbVN0YWNrIHByb2R1Y2VzIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSB0ZW1wbGF0ZSByZXRyaWV2ZWQgZnJvbSBDbG91ZEZvcm1hdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IGZzLnJlYWRGaWxlU3luYyh2YWxpZFRlbXBsYXRlUGF0aCwgeyBlbmNvZGluZzogJ3V0Zi04JyB9KTtcbiAgICBnZXRUZW1wbGF0ZU1vY2subW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgICBUZW1wbGF0ZUJvZHk6IHRlbXBsYXRlLFxuICAgIH0pKTtcblxuICAgIGRlc2NyaWJlU3RhY2tzTW9jay5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICAgIFN0YWNrczogW1xuICAgICAgICB7XG4gICAgICAgICAgU3RhY2tOYW1lOiAndGhpcy1vbmUnLFxuICAgICAgICAgIFN0YWNrU3RhdHVzOiAnQ1JFQVRFX0NPTVBMRVRFJyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSkpO1xuXG4gICAgZXhwZWN0KGF3YWl0IHJlYWRGcm9tU3RhY2soJ3RoaXMtb25lJywgc2RrUHJvdmlkZXIsIHsgYWNjb3VudDogJ251bScsIHJlZ2lvbjogJ2hlcmUnLCBuYW1lOiAnaGVsbG8tbXktbmFtZS1pcy13aGF0Li4uJyB9KSkudG9FcXVhbChKU09OLnN0cmluZ2lmeShKU09OLnBhcnNlKHRlbXBsYXRlKSkpO1xuICB9KTtcblxuICB0ZXN0KCdyZWFkRnJvbVN0YWNrIHRocm93cyBlcnJvciB3aGVuIG5vIHN0YWNrIGV4aXN0cyB3aXRoIHRoZSBzdGFjayBuYW1lIGluIHRoZSBhY2NvdW50IGFuZCByZWdpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgZGVzY3JpYmVTdGFja3NNb2NrLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7IHRocm93IG5ldyBFcnJvcignTm8gc3RhY2suIFRoaXMgZGlkIG5vdCBnbyB3ZWxsLicpOyB9KTtcbiAgICBhd2FpdCBleHBlY3QoKCkgPT4gcmVhZEZyb21TdGFjaygndGhhdC1vbmUnLCBzZGtQcm92aWRlciwgeyBhY2NvdW50OiAnbnVtJywgcmVnaW9uOiAnaGVyZScsIG5hbWU6ICdoZWxsby1teS1uYW1lLWlzLXdoby4uLicgfSkpLnJlamVjdHMudG9UaHJvdygnTm8gc3RhY2suIFRoaXMgZGlkIG5vdCBnbyB3ZWxsLicpO1xuICB9KTtcblxuICB0ZXN0KCdyZWFkRnJvbVN0YWNrIHRocm93cyBlcnJvciB3aGVuIHN0YWNrIGV4aXN0cyBidXQgdGhlIHN0YXR1cyBpcyBub3QgaGVhbHRoeScsIGFzeW5jICgpID0+IHtcbiAgICBkZXNjcmliZVN0YWNrc01vY2subW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgICBTdGFja3M6IFtcbiAgICAgICAge1xuICAgICAgICAgIFN0YWNrTmFtZTogJ3RoaXMtb25lJyxcbiAgICAgICAgICBTdGFja1N0YXR1czogJ0NSRUFURV9GQUlMRUQnLFxuICAgICAgICAgIFN0YWNrU3RhdHVzUmVhc29uOiAnU29tZXRoaW5nIHdlbnQgd3JvbmcnLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KSk7XG5cbiAgICBhd2FpdCBleHBlY3QoKCkgPT4gcmVhZEZyb21TdGFjaygndGhhdC1vbmUnLCBzZGtQcm92aWRlciwgeyBhY2NvdW50OiAnbnVtJywgcmVnaW9uOiAnaGVyZScsIG5hbWU6ICdoZWxsby1teS1uYW1lLWlzLWNoaWNrYS1jaGlja2EuLi4nIH0pKS5yZWplY3RzLnRvVGhyb3coJ1N0YWNrIFxcJ3RoYXQtb25lXFwnIGluIGFjY291bnQgbnVtIGFuZCByZWdpb24gaGVyZSBoYXMgYSBzdGF0dXMgb2YgXFwnQ1JFQVRFX0ZBSUxFRFxcJyBkdWUgdG8gXFwnU29tZXRoaW5nIHdlbnQgd3JvbmdcXCcuIFRoZSBzdGFjayBjYW5ub3QgYmUgbWlncmF0ZWQgdW50aWwgaXQgaXMgaW4gYSBoZWFsdGh5IHN0YXRlLicpO1xuICB9KTtcblxuICB0ZXN0KCdzZXRFbnZpcm9ubWVudCBzZXRzIGFjY291bnQgYW5kIHJlZ2lvbiB3aGVuIHByb3ZpZGVkJywgKCkgPT4ge1xuICAgIGV4cGVjdChzZXRFbnZpcm9ubWVudCgnbXktYWNjb3VudCcsICdzb21ld2hlcmUnKSkudG9FcXVhbCh7IGFjY291bnQ6ICdteS1hY2NvdW50JywgcmVnaW9uOiAnc29tZXdoZXJlJywgbmFtZTogJ2Nkay1taWdyYXRlLWVudicgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3NlckVudmlyb25tZW50IHVzZXMgZGVmYXVsdCBhY2NvdW50IGFuZCByZWdpb24gd2hlbiBub3QgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgZXhwZWN0KHNldEVudmlyb25tZW50KCkpLnRvRXF1YWwoeyBhY2NvdW50OiAndW5rbm93bi1hY2NvdW50JywgcmVnaW9uOiAndW5rbm93bi1yZWdpb24nLCBuYW1lOiAnY2RrLW1pZ3JhdGUtZW52JyB9KTtcbiAgfSk7XG5cbiAgdGVzdCgnZ2VuZXJhdGVTdGFjayBnZW5lcmF0ZXMgdGhlIGV4cGVjdGVkIHN0YWNrIHN0cmluZyB3aGVuIGNhbGxlZCBmb3IgdHlwZXNjcmlwdCcsICgpID0+IHtcbiAgICBjb25zdCBzdGFjayA9IGdlbmVyYXRlU3RhY2sodmFsaWRUZW1wbGF0ZSwgJ0dvb2RUeXBlU2NyaXB0JywgJ3R5cGVzY3JpcHQnKTtcbiAgICBleHBlY3Qoc3RhY2spLnRvRXF1YWwoZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbiguLi5zdGFja1BhdGgsICdzMy1zdGFjay50cycpLCAndXRmOCcpKTtcbiAgfSk7XG5cbiAgdGVzdCgnZ2VuZXJhdGVTdGFjayBnZW5lcmF0ZXMgdGhlIGV4cGVjdGVkIHN0YWNrIHN0cmluZyB3aGVuIGNhbGxlZCBmb3IgcHl0aG9uJywgKCkgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gZ2VuZXJhdGVTdGFjayh2YWxpZFRlbXBsYXRlLCAnR29vZFB5dGhvbicsICdweXRob24nKTtcbiAgICBleHBlY3Qoc3RhY2spLnRvRXF1YWwoZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbiguLi5zdGFja1BhdGgsICdzM19zdGFjay5weScpLCAndXRmOCcpKTtcbiAgfSk7XG5cbiAgdGVzdCgnZ2VuZXJhdGVTdGFjayBnZW5lcmF0ZXMgdGhlIGV4cGVjdGVkIHN0YWNrIHN0cmluZyB3aGVuIGNhbGxlZCBmb3IgamF2YScsICgpID0+IHtcbiAgICBjb25zdCBzdGFjayA9IGdlbmVyYXRlU3RhY2sodmFsaWRUZW1wbGF0ZSwgJ0dvb2RKYXZhJywgJ2phdmEnKTtcbiAgICBleHBlY3Qoc3RhY2spLnRvRXF1YWwoZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbiguLi5zdGFja1BhdGgsICdTM1N0YWNrLmphdmEnKSwgJ3V0ZjgnKSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2dlbmVyYXRlU3RhY2sgZ2VuZXJhdGVzIHRoZSBleHBlY3RlZCBzdGFjayBzdHJpbmcgd2hlbiBjYWxsZWQgZm9yIGNzaGFycCcsICgpID0+IHtcbiAgICBjb25zdCBzdGFjayA9IGdlbmVyYXRlU3RhY2sodmFsaWRUZW1wbGF0ZSwgJ0dvb2RDU2hhcnAnLCAnY3NoYXJwJyk7XG4gICAgZXhwZWN0KHN0YWNrKS50b0VxdWFsKGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4oLi4uc3RhY2tQYXRoLCAnUzNTdGFjay5jcycpLCAndXRmOCcpKTtcbiAgfSk7XG5cbiAgLy8gVE9ETzogZml4IHdpdGggYWN0dWFsIGdvIHRlbXBsYXRlXG4gIHRlc3QoJ2dlbmVyYXRlU3RhY2sgZ2VuZXJhdGVzIHRoZSBleHBlY3RlZCBzdGFjayBzdHJpbmcgd2hlbiBjYWxsZWQgZm9yIGdvJywgKCkgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gZ2VuZXJhdGVTdGFjayh2YWxpZFRlbXBsYXRlLCAnR29vZEdvJywgJ2dvJyk7XG4gICAgZXhwZWN0KHN0YWNrKS50b0VxdWFsKGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4oLi4uc3RhY2tQYXRoLCAnczMuZ28nKSwgJ3V0ZjgnKSk7XG4gIH0pO1xuXG4gIHRlc3QoJ2dlbmVyYXRlU3RhY2sgdGhyb3dzIGVycm9yIHdoZW4gY2FsbGVkIGZvciBvdGhlciBsYW5ndWFnZScsICgpID0+IHtcbiAgICBleHBlY3QoKCkgPT4gZ2VuZXJhdGVTdGFjayh2YWxpZFRlbXBsYXRlLCAnQmFkQmFkQmFkJywgJ3BocCcpKS50b1Rocm93RXJyb3IoJ3N0YWNrIGdlbmVyYXRpb24gZmFpbGVkIGR1ZSB0byBlcnJvciBcXCd1bnJlYWNoYWJsZVxcJycpO1xuICB9KTtcblxuICBjbGlUZXN0KCdnZW5lcmF0ZUNka0FwcCBnZW5lcmF0ZXMgdGhlIGV4cGVjdGVkIGNkayBhcHAgd2hlbiBjYWxsZWQgZm9yIHR5cGVzY3JpcHQnLCBhc3luYyAod29ya0RpcikgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gZ2VuZXJhdGVTdGFjayh2YWxpZFRlbXBsYXRlLCAnR29vZFR5cGVTY3JpcHQnLCAndHlwZXNjcmlwdCcpO1xuICAgIGF3YWl0IGdlbmVyYXRlQ2RrQXBwKCdHb29kVHlwZVNjcmlwdCcsIHN0YWNrLCAndHlwZXNjcmlwdCcsIHdvcmtEaXIpO1xuXG4gICAgLy8gUGFja2FnZXMgZXhpc3QgaW4gdGhlIGNvcnJlY3Qgc3BvdFxuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RUeXBlU2NyaXB0JywgJ3BhY2thZ2UuanNvbicpKSkudG9CZVRydXRoeSgpO1xuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RUeXBlU2NyaXB0JywgJ2JpbicsICdnb29kX3R5cGVfc2NyaXB0LnRzJykpKS50b0JlVHJ1dGh5KCk7XG4gICAgZXhwZWN0KGZzLnBhdGhFeGlzdHNTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZFR5cGVTY3JpcHQnLCAnbGliJywgJ2dvb2RfdHlwZV9zY3JpcHQtc3RhY2sudHMnKSkpLnRvQmVUcnV0aHkoKTtcblxuICAgIC8vIFJlcGxhY2VkIHN0YWNrIGZpbGUgaXMgcmVmZXJlbmNlZCBjb3JyZWN0bHkgaW4gYXBwIGZpbGVcbiAgICBjb25zdCBhcHAgPSBmcy5yZWFkRmlsZVN5bmMocGF0aC5qb2luKHdvcmtEaXIsICdHb29kVHlwZVNjcmlwdCcsICdiaW4nLCAnZ29vZF90eXBlX3NjcmlwdC50cycpLCAndXRmOCcpLnNwbGl0KCdcXG4nKTtcbiAgICBleHBlY3QoYXBwLm1hcChsaW5lID0+IGxpbmUubWF0Y2goJ2ltcG9ydCB7IEdvb2RUeXBlU2NyaXB0U3RhY2sgfSBmcm9tIFxcJy4uL2xpYi9nb29kX3R5cGVfc2NyaXB0LXN0YWNrXFwnOycpKS5maWx0ZXIobGluZSA9PiBsaW5lKS5sZW5ndGgpLnRvRXF1YWwoMSk7XG4gICAgZXhwZWN0KGFwcC5tYXAobGluZSA9PiBsaW5lLm1hdGNoKC9uZXcgR29vZFR5cGVTY3JpcHRTdGFja1xcKGFwcCwgXFwnR29vZFR5cGVTY3JpcHRcXCcsIFxcey8pKS5maWx0ZXIobGluZSA9PiBsaW5lKS5sZW5ndGgpLnRvRXF1YWwoMSk7XG5cbiAgICAvLyBSZXBsYWNlZCBzdGFjayBmaWxlIGlzIGNvcnJlY3RseSBnZW5lcmF0ZWRcbiAgICBjb25zdCByZXBsYWNlZFN0YWNrID0gZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZFR5cGVTY3JpcHQnLCAnbGliJywgJ2dvb2RfdHlwZV9zY3JpcHQtc3RhY2sudHMnKSwgJ3V0ZjgnKTtcbiAgICBleHBlY3QocmVwbGFjZWRTdGFjaykudG9FcXVhbChmcy5yZWFkRmlsZVN5bmMocGF0aC5qb2luKC4uLnN0YWNrUGF0aCwgJ3MzLXN0YWNrLnRzJyksICd1dGY4JykpO1xuICB9KTtcblxuICBjbGlUZXN0KCdnZW5lcmF0ZUNka0FwcCBnZW5lcmF0ZXMgdGhlIGV4cGVjdGVkIGNkayBhcHAgd2hlbiBjYWxsZWQgZm9yIHB5dGhvbicsIGFzeW5jICh3b3JrRGlyKSA9PiB7XG4gICAgY29uc3Qgc3RhY2sgPSBnZW5lcmF0ZVN0YWNrKHZhbGlkVGVtcGxhdGUsICdHb29kUHl0aG9uJywgJ3B5dGhvbicpO1xuICAgIGF3YWl0IGdlbmVyYXRlQ2RrQXBwKCdHb29kUHl0aG9uJywgc3RhY2ssICdweXRob24nLCB3b3JrRGlyKTtcblxuICAgIC8vIFBhY2thZ2VzIGV4aXN0IGluIHRoZSBjb3JyZWN0IHNwb3RcbiAgICBleHBlY3QoZnMucGF0aEV4aXN0c1N5bmMocGF0aC5qb2luKHdvcmtEaXIsICdHb29kUHl0aG9uJywgJ3JlcXVpcmVtZW50cy50eHQnKSkpLnRvQmVUcnV0aHkoKTtcbiAgICBleHBlY3QoZnMucGF0aEV4aXN0c1N5bmMocGF0aC5qb2luKHdvcmtEaXIsICdHb29kUHl0aG9uJywgJ2FwcC5weScpKSkudG9CZVRydXRoeSgpO1xuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RQeXRob24nLCAnZ29vZF9weXRob24nLCAnZ29vZF9weXRob25fc3RhY2sucHknKSkpLnRvQmVUcnV0aHkoKTtcblxuICAgIC8vIFJlcGxhY2VkIHN0YWNrIGZpbGUgaXMgcmVmZXJlbmNlZCBjb3JyZWN0bHkgaW4gYXBwIGZpbGVcbiAgICBjb25zdCBhcHAgPSBmcy5yZWFkRmlsZVN5bmMocGF0aC5qb2luKHdvcmtEaXIsICdHb29kUHl0aG9uJywgJ2FwcC5weScpLCAndXRmOCcpLnNwbGl0KCdcXG4nKTtcbiAgICBleHBlY3QoYXBwLm1hcChsaW5lID0+IGxpbmUubWF0Y2goJ2Zyb20gZ29vZF9weXRob24uZ29vZF9weXRob25fc3RhY2sgaW1wb3J0IEdvb2RQeXRob25TdGFjaycpKS5maWx0ZXIobGluZSA9PiBsaW5lKS5sZW5ndGgpLnRvRXF1YWwoMSk7XG4gICAgZXhwZWN0KGFwcC5tYXAobGluZSA9PiBsaW5lLm1hdGNoKC9Hb29kUHl0aG9uU3RhY2tcXChhcHAsIFwiR29vZFB5dGhvblwiLC8pKS5maWx0ZXIobGluZSA9PiBsaW5lKS5sZW5ndGgpLnRvRXF1YWwoMSk7XG5cbiAgICAvLyBSZXBsYWNlZCBzdGFjayBmaWxlIGlzIGNvcnJlY3RseSBnZW5lcmF0ZWRcbiAgICBjb25zdCByZXBsYWNlZFN0YWNrID0gZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZFB5dGhvbicsICdnb29kX3B5dGhvbicsICdnb29kX3B5dGhvbl9zdGFjay5weScpLCAndXRmOCcpO1xuICAgIGV4cGVjdChyZXBsYWNlZFN0YWNrKS50b0VxdWFsKGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4oLi4uc3RhY2tQYXRoLCAnczNfc3RhY2sucHknKSwgJ3V0ZjgnKSk7XG4gIH0pO1xuXG4gIGNsaVRlc3QoJ2dlbmVyYXRlQ2RrQXBwIGdlbmVyYXRlcyB0aGUgZXhwZWN0ZWQgY2RrIGFwcCB3aGVuIGNhbGxlZCBmb3IgamF2YScsIGFzeW5jICh3b3JrRGlyKSA9PiB7XG4gICAgY29uc3Qgc3RhY2sgPSBnZW5lcmF0ZVN0YWNrKHZhbGlkVGVtcGxhdGUsICdHb29kSmF2YScsICdqYXZhJyk7XG4gICAgYXdhaXQgZ2VuZXJhdGVDZGtBcHAoJ0dvb2RKYXZhJywgc3RhY2ssICdqYXZhJywgd29ya0Rpcik7XG5cbiAgICAvLyBQYWNrYWdlcyBleGlzdCBpbiB0aGUgY29ycmVjdCBzcG90XG4gICAgZXhwZWN0KGZzLnBhdGhFeGlzdHNTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZEphdmEnLCAncG9tLnhtbCcpKSkudG9CZVRydXRoeSgpO1xuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RKYXZhJywgJ3NyYycsICdtYWluJywgJ2phdmEnLCAnY29tJywgJ215b3JnJywgJ0dvb2RKYXZhQXBwLmphdmEnKSkpLnRvQmVUcnV0aHkoKTtcbiAgICBleHBlY3QoZnMucGF0aEV4aXN0c1N5bmMocGF0aC5qb2luKHdvcmtEaXIsICdHb29kSmF2YScsICdzcmMnLCAnbWFpbicsICdqYXZhJywgJ2NvbScsICdteW9yZycsICdHb29kSmF2YVN0YWNrLmphdmEnKSkpLnRvQmVUcnV0aHkoKTtcblxuICAgIC8vIFJlcGxhY2VkIHN0YWNrIGZpbGUgaXMgcmVmZXJlbmNlZCBjb3JyZWN0bHkgaW4gYXBwIGZpbGVcbiAgICBjb25zdCBhcHAgPSBmcy5yZWFkRmlsZVN5bmMocGF0aC5qb2luKHdvcmtEaXIsICdHb29kSmF2YScsICdzcmMnLCAnbWFpbicsICdqYXZhJywgJ2NvbScsICdteW9yZycsICdHb29kSmF2YUFwcC5qYXZhJyksICd1dGY4Jykuc3BsaXQoJ1xcbicpO1xuICAgIGV4cGVjdChhcHAubWFwKGxpbmUgPT4gbGluZS5tYXRjaCgncHVibGljIGNsYXNzIEdvb2RKYXZhQXBwIHsnKSkuZmlsdGVyKGxpbmUgPT4gbGluZSkubGVuZ3RoKS50b0VxdWFsKDEpO1xuICAgIGV4cGVjdChhcHAubWFwKGxpbmUgPT4gbGluZS5tYXRjaCgvICAgICAgICBuZXcgR29vZEphdmFTdGFja1xcKGFwcCwgXCJHb29kSmF2YVwiLCBTdGFja1Byb3BzLmJ1aWxkZXIoKS8pKS5maWx0ZXIobGluZSA9PiBsaW5lKS5sZW5ndGgpLnRvRXF1YWwoMSk7XG5cbiAgICAvLyBSZXBsYWNlZCBzdGFjayBmaWxlIGlzIGNvcnJlY3RseSBnZW5lcmF0ZWRcbiAgICBjb25zdCByZXBsYWNlZFN0YWNrID0gZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZEphdmEnLCAnc3JjJywgJ21haW4nLCAnamF2YScsICdjb20nLCAnbXlvcmcnLCAnR29vZEphdmFTdGFjay5qYXZhJyksICd1dGY4Jyk7XG4gICAgZXhwZWN0KHJlcGxhY2VkU3RhY2spLnRvRXF1YWwoZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbiguLi5zdGFja1BhdGgsICdTM1N0YWNrLmphdmEnKSwgJ3V0ZjgnKSk7XG4gIH0pO1xuXG4gIGNsaVRlc3QoJ2dlbmVyYXRlQ2RrQXBwIGdlbmVyYXRlcyB0aGUgZXhwZWN0ZWQgY2RrIGFwcCB3aGVuIGNhbGxlZCBmb3IgY3NoYXJwJywgYXN5bmMgKHdvcmtEaXIpID0+IHtcbiAgICBjb25zdCBzdGFjayA9IGdlbmVyYXRlU3RhY2sodmFsaWRUZW1wbGF0ZSwgJ0dvb2RDU2hhcnAnLCAnY3NoYXJwJyk7XG4gICAgYXdhaXQgZ2VuZXJhdGVDZGtBcHAoJ0dvb2RDU2hhcnAnLCBzdGFjaywgJ2NzaGFycCcsIHdvcmtEaXIpO1xuXG4gICAgLy8gUGFja2FnZXMgZXhpc3QgaW4gdGhlIGNvcnJlY3Qgc3BvdFxuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RDU2hhcnAnLCAnc3JjJywgJ0dvb2RDU2hhcnAuc2xuJykpKS50b0JlVHJ1dGh5KCk7XG4gICAgZXhwZWN0KGZzLnBhdGhFeGlzdHNTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZENTaGFycCcsICdzcmMnLCAnR29vZENTaGFycCcsICdQcm9ncmFtLmNzJykpKS50b0JlVHJ1dGh5KCk7XG4gICAgZXhwZWN0KGZzLnBhdGhFeGlzdHNTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZENTaGFycCcsICdzcmMnLCAnR29vZENTaGFycCcsICdHb29kQ1NoYXJwU3RhY2suY3MnKSkpLnRvQmVUcnV0aHkoKTtcblxuICAgIC8vIFJlcGxhY2VkIHN0YWNrIGZpbGUgaXMgcmVmZXJlbmNlZCBjb3JyZWN0bHkgaW4gYXBwIGZpbGVcbiAgICBjb25zdCBhcHAgPSBmcy5yZWFkRmlsZVN5bmMocGF0aC5qb2luKHdvcmtEaXIsICdHb29kQ1NoYXJwJywgJ3NyYycsICdHb29kQ1NoYXJwJywgJ1Byb2dyYW0uY3MnKSwgJ3V0ZjgnKS5zcGxpdCgnXFxuJyk7XG4gICAgZXhwZWN0KGFwcC5tYXAobGluZSA9PiBsaW5lLm1hdGNoKCduYW1lc3BhY2UgR29vZENTaGFycCcpKS5maWx0ZXIobGluZSA9PiBsaW5lKS5sZW5ndGgpLnRvRXF1YWwoMSk7XG4gICAgZXhwZWN0KGFwcC5tYXAobGluZSA9PiBsaW5lLm1hdGNoKC8gICAgICAgIG5ldyBHb29kQ1NoYXJwU3RhY2tcXChhcHAsIFwiR29vZENTaGFycFwiLCBuZXcgR29vZENTaGFycFN0YWNrUHJvcHMvKSkuZmlsdGVyKGxpbmUgPT4gbGluZSkubGVuZ3RoKS50b0VxdWFsKDEpO1xuXG4gICAgLy8gUmVwbGFjZWQgc3RhY2sgZmlsZSBpcyBjb3JyZWN0bHkgZ2VuZXJhdGVkXG4gICAgY29uc3QgcmVwbGFjZWRTdGFjayA9IGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RDU2hhcnAnLCAnc3JjJywgJ0dvb2RDU2hhcnAnLCAnR29vZENTaGFycFN0YWNrLmNzJyksICd1dGY4Jyk7XG4gICAgZXhwZWN0KHJlcGxhY2VkU3RhY2spLnRvRXF1YWwoZnMucmVhZEZpbGVTeW5jKHBhdGguam9pbiguLi5zdGFja1BhdGgsICdTM1N0YWNrLmNzJyksICd1dGY4JykpO1xuICB9KTtcblxuICBjbGlUZXN0KCdnZW5lcmF0ZWRDZGtBcHAgZ2VuZXJhdGVzIHRoZSBleHBlY3RlZCBjZGsgYXBwIHdoZW4gY2FsbGVkIGZvciBnbycsIGFzeW5jICh3b3JrRGlyKSA9PiB7XG4gICAgY29uc3Qgc3RhY2sgPSBnZW5lcmF0ZVN0YWNrKHZhbGlkVGVtcGxhdGUsICdHb29kR28nLCAnZ28nKTtcbiAgICBhd2FpdCBnZW5lcmF0ZUNka0FwcCgnR29vZEdvJywgc3RhY2ssICdnbycsIHdvcmtEaXIpO1xuXG4gICAgZXhwZWN0KGZzLnBhdGhFeGlzdHMocGF0aC5qb2luKHdvcmtEaXIsICdzMy5nbycpKSkudG9CZVRydXRoeSgpO1xuICAgIGNvbnN0IGFwcCA9IGZzLnJlYWRGaWxlU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RHbycsICdnb29kX2dvLmdvJyksICd1dGY4Jykuc3BsaXQoJ1xcbicpO1xuICAgIGV4cGVjdChhcHAubWFwKGxpbmUgPT4gbGluZS5tYXRjaCgvZnVuYyBOZXdHb29kR29TdGFja1xcKHNjb3BlIGNvbnN0cnVjdHMuQ29uc3RydWN0LCBpZCBzdHJpbmcsIHByb3BzIFxcKkdvb2RHb1N0YWNrUHJvcHNcXCkgXFwqR29vZEdvU3RhY2sgXFx7LykpLmZpbHRlcihsaW5lID0+IGxpbmUpLmxlbmd0aCkudG9FcXVhbCgxKTtcbiAgICBleHBlY3QoYXBwLm1hcChsaW5lID0+IGxpbmUubWF0Y2goLyAgICBOZXdHb29kR29TdGFja1xcKGFwcCwgXCJHb29kR29cIiwgJkdvb2RHb1N0YWNrUHJvcHNcXHsvKSkpO1xuICB9KTtcblxuICBjbGlUZXN0KCdnZW5lcmF0ZWRDZGtBcHAgZ2VuZXJhdGVzIGEgemlwIGZpbGUgd2hlbiAtLWNvbXByZXNzIGlzIHVzZWQnLCBhc3luYyAod29ya0RpcikgPT4ge1xuICAgIGNvbnN0IHN0YWNrID0gZ2VuZXJhdGVTdGFjayh2YWxpZFRlbXBsYXRlLCAnR29vZFR5cGVTY3JpcHQnLCAndHlwZXNjcmlwdCcpO1xuICAgIGF3YWl0IGdlbmVyYXRlQ2RrQXBwKCdHb29kVHlwZVNjcmlwdCcsIHN0YWNrLCAndHlwZXNjcmlwdCcsIHdvcmtEaXIsIHRydWUpO1xuXG4gICAgLy8gUGFja2FnZXMgbm90IGluIG91dERpclxuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RUeXBlU2NyaXB0JywgJ3BhY2thZ2UuanNvbicpKSkudG9CZUZhbHN5KCk7XG4gICAgZXhwZWN0KGZzLnBhdGhFeGlzdHNTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnR29vZFR5cGVTY3JpcHQnLCAnYmluJywgJ2dvb2RfdHlwZV9zY3JpcHQudHMnKSkpLnRvQmVGYWxzeSgpO1xuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RUeXBlU2NyaXB0JywgJ2xpYicsICdnb29kX3R5cGVfc2NyaXB0LXN0YWNrLnRzJykpKS50b0JlRmFsc3koKTtcblxuICAgIC8vIFppcCBmaWxlIGV4aXN0c1xuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ0dvb2RUeXBlU2NyaXB0LnppcCcpKSkudG9CZVRydXRoeSgpO1xuXG4gICAgLy8gVW56aXAgaXRcbiAgICBhd2FpdCBleGVjKGB1bnppcCAke3BhdGguam9pbih3b3JrRGlyLCAnR29vZFR5cGVTY3JpcHQuemlwJyl9YCwgeyBjd2Q6IHdvcmtEaXIgfSk7XG5cbiAgICAvLyBOb3cgdGhlIGZpbGVzIHNob3VsZCBiZSB0aGVyZVxuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ3BhY2thZ2UuanNvbicpKSkudG9CZVRydXRoeSgpO1xuICAgIGV4cGVjdChmcy5wYXRoRXhpc3RzU3luYyhwYXRoLmpvaW4od29ya0RpciwgJ2JpbicsICdnb29kX3R5cGVfc2NyaXB0LnRzJykpKS50b0JlVHJ1dGh5KCk7XG4gICAgZXhwZWN0KGZzLnBhdGhFeGlzdHNTeW5jKHBhdGguam9pbih3b3JrRGlyLCAnbGliJywgJ2dvb2RfdHlwZV9zY3JpcHQtc3RhY2sudHMnKSkpLnRvQmVUcnV0aHkoKTtcbiAgfSk7XG59KTtcblxuZnVuY3Rpb24gY2xpVGVzdChuYW1lOiBzdHJpbmcsIGhhbmRsZXI6IChkaXI6IHN0cmluZykgPT4gdm9pZCB8IFByb21pc2U8YW55Pik6IHZvaWQge1xuICB0ZXN0KG5hbWUsICgpID0+IHdpdGhUZW1wRGlyKGhhbmRsZXIpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gd2l0aFRlbXBEaXIoY2I6IChkaXI6IHN0cmluZykgPT4gdm9pZCB8IFByb21pc2U8YW55Pikge1xuICBjb25zdCB0bXBEaXIgPSBhd2FpdCBmcy5ta2R0ZW1wKHBhdGguam9pbihvcy50bXBkaXIoKSwgJ2F3cy1jZGstdGVzdCcpKTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBjYih0bXBEaXIpO1xuICB9IGZpbmFsbHkge1xuICAgIGF3YWl0IGZzLnJlbW92ZSh0bXBEaXIpO1xuICB9XG59Il19